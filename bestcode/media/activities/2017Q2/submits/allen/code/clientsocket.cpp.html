<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }
body .hll { background-color: #ffffcc }
body  { background: #f8f8f8; }
body .c { color: #408080; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
body .cm { color: #408080; font-style: italic } /* Comment.Multiline */
body .cp { color: #BC7A00 } /* Comment.Preproc */
body .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
body .c1 { color: #408080; font-style: italic } /* Comment.Single */
body .cs { color: #408080; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #FF0000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #00A000 } /* Generic.Inserted */
body .go { color: #888888 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #7D9029 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #999999; font-weight: bold } /* Name.Entity */
body .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #A0A000 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mb { color: #666666 } /* Literal.Number.Bin */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sa { color: #BA2121 } /* Literal.String.Affix */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .dl { color: #BA2121 } /* Literal.String.Delimiter */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #BB6688 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .fm { color: #0000FF } /* Name.Function.Magic */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .vm { color: #19177C } /* Name.Variable.Magic */
body .il { color: #666666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;clientsocket.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;deque&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;QDebug&gt;</span><span class="cp"></span>

<span class="cp">#define WM_SESSIONNOTIFY    WM_USER+100</span>

<span class="n">ClientSocket</span><span class="o">::</span><span class="n">ClientSocket</span><span class="p">()</span>
    <span class="o">:</span><span class="n">m_pSessionManager</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span>
    <span class="p">,</span><span class="n">m_pFactory</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span>
    <span class="p">,</span><span class="n">m_pNetFileManager</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span>
    <span class="p">,</span><span class="n">m_fcMainThreadCall</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span>
    <span class="p">,</span><span class="n">m_fcWbSink</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span>
    <span class="p">,</span><span class="n">m_dwUserID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">,</span><span class="n">m_dwCheckCode</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">,</span><span class="n">m_wSrvAppID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">,</span><span class="n">m_wSessionID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">,</span><span class="n">m_pMemoryAllocator</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span>
    <span class="p">,</span><span class="n">m_bRun</span><span class="p">(</span><span class="n">FALSE</span><span class="p">)</span>
    <span class="p">,</span><span class="n">m_pResponse</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span>
    <span class="p">,</span><span class="n">m_bFirstWB</span><span class="p">(</span><span class="n">FALSE</span><span class="p">)</span>
    <span class="p">,</span><span class="n">m_bWbLogin</span><span class="p">(</span><span class="n">FALSE</span><span class="p">)</span>
    <span class="p">,</span><span class="n">m_nWBServerStatus</span><span class="p">(</span><span class="n">WB_EVENT_CONNECTING</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m_Notify</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">WBASE_NOTIFY</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m_guid</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">GUID</span><span class="p">));</span>
<span class="p">}</span>


<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：客户端析构函数</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：</span>
<span class="cm"> * 依赖：</span>
<span class="cm"> * 影响：</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="n">ClientSocket</span><span class="o">::~</span><span class="n">ClientSocket</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">m_fcWbSink</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">m_pSessionManager</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">m_pFactory</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">m_pNetFileManager</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">m_fcMainThreadCall</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">m_pResponse</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">m_bRun</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">StopThread</span><span class="p">();</span>

    <span class="n">m_WBMsgProcessor</span><span class="p">.</span><span class="n">Release</span><span class="p">();</span>
<span class="p">}</span>
<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：客户端初始化</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：</span>
<span class="cm"> * 依赖：白板调用MultiWhiteBoard</span>
<span class="cm"> * 影响：</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="n">BOOL</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">Initialized</span><span class="p">(</span><span class="n">ISessionManager2</span> <span class="o">*</span><span class="n">pSessionManager</span><span class="p">,</span><span class="n">IComponentFactory</span> <span class="o">*</span><span class="n">pFactory</span><span class="p">,</span><span class="n">IFileManager</span> <span class="o">*</span><span class="n">pNetFileManager</span><span class="p">,</span><span class="k">const</span> <span class="n">WBASE_NOTIFY</span> <span class="o">&amp;</span><span class="n">notify</span><span class="p">,</span><span class="n">FUNC_MSGTOMAIN</span> <span class="n">funcMsgToMain</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">m_pSessionManager</span> <span class="o">=</span> <span class="n">pSessionManager</span><span class="p">;</span>
    <span class="n">m_pFactory</span> <span class="o">=</span> <span class="n">pFactory</span><span class="p">;</span>
    <span class="n">m_pNetFileManager</span> <span class="o">=</span> <span class="n">pNetFileManager</span><span class="p">;</span>
    <span class="n">m_Notify</span> <span class="o">=</span> <span class="n">notify</span><span class="p">;</span>
    <span class="n">m_fcMainThreadCall</span> <span class="o">=</span> <span class="n">funcMsgToMain</span><span class="p">;</span><span class="c1">//任务交给主线程函数处理入口，向主线程发送信号通知，让主线程回调处理</span>

    <span class="n">FS_HRESULT</span> <span class="n">hr</span> <span class="o">=</span> <span class="n">pFactory</span><span class="o">-&gt;</span><span class="n">QueryInterface</span><span class="p">(</span><span class="n">IID_IMemoryAllocator</span><span class="p">,(</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">m_pMemoryAllocator</span><span class="p">);</span><span class="c1">//查询组件是否支持</span>
    <span class="k">if</span><span class="p">(</span><span class="n">FAILED</span><span class="p">(</span><span class="n">hr</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：设置白板的Sink</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：</span>
<span class="cm"> * 依赖：白板调用MultiWhiteBoard</span>
<span class="cm"> * 影响：</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">SetWBSinkSource</span><span class="p">(</span><span class="n">FUNC_WBSINK</span> <span class="n">funcWbSink</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">m_fcWbSink</span> <span class="o">=</span> <span class="n">funcWbSink</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：创建会话</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：对白板开放</span>
<span class="cm"> * 依赖：白板调用，MultiWhiteBoard</span>
<span class="cm"> * 影响：开启线程,调用私有的连接函数</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="n">BOOL</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="k">const</span> <span class="n">GUID</span> <span class="o">*</span><span class="n">pGuid</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">dwUserID</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">dwCheckCode</span><span class="p">,</span><span class="n">WORD</span> <span class="n">wAppID</span><span class="p">,</span><span class="k">const</span> <span class="n">CHAR</span> <span class="o">*</span><span class="n">lpszSrvAddrLink</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">m_guid</span> <span class="o">=</span> <span class="o">*</span><span class="n">pGuid</span><span class="p">;</span>
    <span class="n">m_dwUserID</span> <span class="o">=</span> <span class="n">dwUserID</span><span class="p">;</span>
    <span class="n">m_dwCheckCode</span> <span class="o">=</span> <span class="n">dwCheckCode</span><span class="p">;</span>
    <span class="n">m_wSrvAppID</span> <span class="o">=</span> <span class="n">wAppID</span><span class="p">;</span>
    <span class="n">m_strSrvAddrLink</span> <span class="o">=</span> <span class="n">lpszSrvAddrLink</span><span class="p">;</span>

    <span class="n">m_bRun</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">m_bRun</span> <span class="o">=</span> <span class="n">StartThread</span><span class="p">();</span>

    <span class="k">return</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">CreateSession</span><span class="p">(</span><span class="n">wAppID</span><span class="p">,</span><span class="n">lpszSrvAddrLink</span><span class="p">);</span>

<span class="p">}</span>
<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：设置白板响应</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：对白板公开</span>
<span class="cm"> * 依赖：白板调用MultiWhiteBoard</span>
<span class="cm"> * 影响：</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">SetNetWorkResponse</span><span class="p">(</span><span class="n">INetWorkResponse</span> <span class="o">*</span><span class="n">pResponse</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">m_pResponse</span> <span class="o">=</span> <span class="n">pResponse</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：解析路径</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：私有，服务自身</span>
<span class="cm"> * 依赖：</span>
<span class="cm"> * 影响：</span>
<span class="cm"> * 日期：2017.07.26</span>
<span class="cm"> * 修改：无</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="n">CHAR</span><span class="o">*</span>	<span class="n">ClientSocket</span><span class="o">::</span><span class="n">ParsePath</span><span class="p">(</span> <span class="n">CHAR</span><span class="o">*</span> <span class="n">szPath</span><span class="p">,</span><span class="n">CHAR</span><span class="o">**</span> <span class="n">szName</span><span class="p">,</span><span class="n">CHAR</span><span class="o">**</span> <span class="n">szAttributeName</span><span class="p">,</span><span class="n">CHAR</span><span class="o">**</span> <span class="n">szAttributeValue</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szPath</span> <span class="o">||</span> <span class="n">strlen</span><span class="p">(</span><span class="n">szPath</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">szName</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">szAttributeName</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">szAttributeValue</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="o">*</span><span class="n">szName</span> <span class="o">=</span> <span class="n">szPath</span><span class="p">;</span>
    <span class="o">*</span><span class="n">szAttributeName</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="o">*</span><span class="n">szAttributeValue</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="n">CHAR</span> <span class="o">*</span><span class="n">szReturn</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span> <span class="n">szPath</span><span class="p">,</span><span class="sc">&#39;/&#39;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">szReturn</span> <span class="p">){</span>
        <span class="n">szReturn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="o">++</span><span class="n">szReturn</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">CHAR</span> <span class="o">*</span><span class="n">szFind</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span> <span class="n">szPath</span><span class="p">,</span><span class="sc">&#39; &#39;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">szFind</span> <span class="p">){</span>
        <span class="n">szFind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="o">++</span><span class="n">szFind</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span> <span class="n">szFind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span> <span class="p">)</span> <span class="o">++</span><span class="n">szFind</span><span class="p">;</span>
        <span class="o">*</span><span class="n">szAttributeName</span> <span class="o">=</span> <span class="n">szFind</span><span class="p">;</span>

        <span class="n">szFind</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span> <span class="n">szFind</span><span class="p">,</span><span class="sc">&#39;=&#39;</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">szFind</span> <span class="p">){</span>
            <span class="n">szFind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="o">++</span><span class="n">szFind</span><span class="p">;</span>
            <span class="k">while</span><span class="p">(</span> <span class="n">szFind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span> <span class="p">)</span> <span class="o">++</span><span class="n">szFind</span><span class="p">;</span>
            <span class="o">*</span><span class="n">szAttributeValue</span> <span class="o">=</span> <span class="n">szFind</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">szReturn</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">///</span>
<span class="c1">///</span>
<span class="c1">///</span>
<span class="c1">///----------------------- session message process --------------------------------------------------</span>


<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：消息派分</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：回调函数</span>
<span class="cm"> * 依赖：连接白板服务器时，把此函数注册给会话管理器</span>
<span class="cm"> * 影响：会话管理器回调此函数，进行消息派分</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="n">BOOL</span> <span class="n">EZSTDCALL</span> <span class="n">OnSessionNotifyDispatch</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nMsgID</span><span class="p">,</span><span class="n">WPARAM</span> <span class="n">wParam</span><span class="p">,</span><span class="n">LPARAM</span> <span class="n">lParam</span><span class="p">,</span><span class="n">FS_UINT32</span> <span class="n">dwReserved</span><span class="p">,</span><span class="n">FS_UINT</span> <span class="n">dwUserData</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">nMsgID</span> <span class="o">==</span> <span class="n">WM_SESSIONNOTIFY</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ClientSocket</span> <span class="o">*</span><span class="n">pSocket</span> <span class="o">=</span> <span class="p">(</span><span class="n">ClientSocket</span><span class="o">*</span><span class="p">)</span><span class="n">dwUserData</span><span class="p">;</span>
        <span class="n">pSocket</span><span class="o">-&gt;</span><span class="n">OnSessionNotify</span><span class="p">(</span><span class="n">nMsgID</span><span class="p">,</span><span class="n">wParam</span><span class="p">,</span><span class="n">lParam</span><span class="p">,</span><span class="n">dwReserved</span><span class="p">,</span><span class="n">dwUserData</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：与服务器建立链接</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：私有</span>
<span class="cm"> * 依赖：由公有的create对外</span>
<span class="cm"> * 影响：1、把会话通知接口WBASE_NOTIFY notify注册到会话管理器 2、初始化消息管理类</span>
<span class="cm"> * 日期：2017.07.26</span>
<span class="cm"> * 修改：无</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="n">BOOL</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">CreateSession</span><span class="p">(</span><span class="n">WORD</span> <span class="n">wAppID</span><span class="p">,</span><span class="k">const</span> <span class="n">CHAR</span> <span class="o">*</span><span class="n">lpszSrvAddrLink</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">m_pSessionManager</span> <span class="o">||</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">m_pMemoryAllocator</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">WBASE_NOTIFY</span> <span class="n">notify</span><span class="p">;</span>
    <span class="n">notify</span><span class="p">.</span><span class="n">nNotifyMode</span> <span class="o">=</span> <span class="n">WBASE_NOTIFYMODE_CALLBACK</span><span class="p">;</span>
    <span class="n">notify</span><span class="p">.</span><span class="n">CallbackMode</span><span class="p">.</span><span class="n">pCallback</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">OnSessionNotifyDispatch</span><span class="p">;</span>
    <span class="n">notify</span><span class="p">.</span><span class="n">CallbackMode</span><span class="p">.</span><span class="n">dwUserData</span> <span class="o">=</span> <span class="p">(</span><span class="n">FS_UINT</span><span class="p">)</span><span class="k">this</span><span class="p">;</span>
    <span class="n">notify</span><span class="p">.</span><span class="n">CallbackMode</span><span class="p">.</span><span class="n">nMsgID</span> <span class="o">=</span> <span class="n">WM_SESSIONNOTIFY</span><span class="p">;</span>

    <span class="n">m_wSessionID</span> <span class="o">=</span> <span class="n">m_pSessionManager</span><span class="o">-&gt;</span><span class="n">CreateSession</span><span class="p">(</span><span class="n">lpszSrvAddrLink</span><span class="p">,</span><span class="n">SESSIONTYPE_RELIABLE</span><span class="p">,</span><span class="n">wAppID</span><span class="p">,</span><span class="o">&amp;</span><span class="n">notify</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">m_wSessionID</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">m_WBMsgProcessor</span><span class="p">.</span><span class="n">Init</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="n">m_pSessionManager</span><span class="p">,</span><span class="n">m_pMemoryAllocator</span><span class="p">,</span><span class="n">m_wSessionID</span><span class="p">);</span><span class="c1">//初始化白板消息处理类</span>
    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：收到白板服务器相关消息,丢进消息队列</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：公有</span>
<span class="cm"> * 依赖：由会话管理器回调</span>
<span class="cm"> * 影响：消息提取转换WM，push到消息队列</span>
<span class="cm"> * 日期：2017.07.26</span>
<span class="cm"> * 修改：无</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="n">LRESULT</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">OnSessionNotify</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nMsgID</span><span class="p">,</span><span class="n">WPARAM</span> <span class="n">wParam</span><span class="p">,</span><span class="n">LPARAM</span> <span class="n">lParam</span><span class="p">,</span><span class="n">FS_UINT32</span> <span class="n">dwReserved</span><span class="p">,</span><span class="n">FS_UINT</span> <span class="n">dwUserData</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">m_pSessionManager</span> <span class="o">||</span> <span class="n">lParam</span> <span class="o">!=</span> <span class="n">m_wSessionID</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

    <span class="n">CMsgMpNode</span> <span class="o">*</span><span class="n">pMsg</span> <span class="o">=</span> <span class="n">m_NetMsgAllocator</span><span class="p">.</span><span class="n">Alloc</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span><span class="n">pMsg</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">pMsg</span><span class="o">-&gt;</span><span class="n">SetMessage</span><span class="p">(</span><span class="n">WM_SESSIONNOTIFY</span><span class="p">);</span>
        <span class="n">pMsg</span><span class="o">-&gt;</span><span class="n">SetWParam</span><span class="p">(</span><span class="n">wParam</span><span class="p">);</span>
        <span class="n">pMsg</span><span class="o">-&gt;</span><span class="n">SetLParam</span><span class="p">(</span><span class="n">lParam</span><span class="p">);</span>
        <span class="n">pMsg</span><span class="o">-&gt;</span><span class="n">SetUserData</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">dwUserData</span><span class="p">);</span>
        <span class="n">pMsg</span><span class="o">-&gt;</span><span class="n">SetUserDataEx</span><span class="p">(</span><span class="n">dwReserved</span><span class="p">);</span>
        <span class="n">m_NetMsgQueue</span><span class="p">.</span><span class="n">PushMsg</span><span class="p">(</span><span class="n">pMsg</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：线程异步从消息队列中取数据进行处理</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：线程虚函数，线程的执行主体函数</span>
<span class="cm"> * 依赖：在连接服务器时创建线程</span>
<span class="cm"> * 影响：emit消息到UI线程，让UI线程回调处理</span>
<span class="cm"> * 日期：2017.07.26</span>
<span class="cm"> * 修改：无</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="n">FS_UINT32</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">ThreadProcEx</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">while</span><span class="p">(</span><span class="n">m_bRun</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">CMsgMpNode</span> <span class="o">*</span><span class="n">pMsg</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="n">pMsg</span> <span class="o">=</span> <span class="n">m_NetMsgQueue</span><span class="p">.</span><span class="n">PopMsg</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">pMsg</span> <span class="o">&amp;&amp;</span> <span class="n">m_fcMainThreadCall</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">m_fcMainThreadCall</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="n">pMsg</span><span class="p">);</span><span class="c1">//取到数据丢到主线程处理</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：主线程处理消息</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：回调</span>
<span class="cm"> * 依赖：由UI线程回调执行</span>
<span class="cm"> * 影响：处理消息</span>
<span class="cm"> * 日期：2017.07.26</span>
<span class="cm"> * 修改：无</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="kt">bool</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">handleMsg</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">pMsg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">pMsg</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">CMsgMpNode</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">CMsgMpNode</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">pMsg</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">p</span> <span class="o">&amp;&amp;</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">GetMessage</span><span class="p">()</span> <span class="o">==</span> <span class="n">WM_SESSIONNOTIFY</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SESSION_EVENT</span> <span class="o">*</span><span class="n">pEvent</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="k">while</span><span class="p">((</span><span class="n">pEvent</span> <span class="o">=</span> <span class="n">m_pSessionManager</span><span class="o">-&gt;</span><span class="n">GetEvent</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">GetLParam</span><span class="p">()))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="o">-&gt;</span><span class="n">ProcessSessionEvent</span><span class="p">(</span><span class="n">pEvent</span><span class="p">);</span><span class="c1">//具体消息处理</span>
            <span class="n">m_pSessionManager</span><span class="o">-&gt;</span><span class="n">FreeEvent</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">GetLParam</span><span class="p">(),</span><span class="n">pEvent</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">m_NetMsgAllocator</span><span class="p">.</span><span class="n">Free</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：消息分类，交由消息执行者处理</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：公有</span>
<span class="cm"> * 依赖：是和MultiWBMsgProcessor的通道（白板消息执行对象是在连接服务器时初始化）</span>
<span class="cm"> * 影响：</span>
<span class="cm"> * 日期：2017.07.26</span>
<span class="cm"> * 修改：无</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">ProcessSessionEvent</span><span class="p">(</span><span class="n">SESSION_EVENT</span> <span class="o">*</span><span class="n">pEvent</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">switch</span><span class="p">(</span> <span class="n">pEvent</span><span class="o">-&gt;</span><span class="n">nEventType</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nl">SESSION_EVENT_ACCEPT</span><span class="p">:</span>
            <span class="n">assert</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">SESSION_EVENT_CREATED</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">pEvent</span><span class="o">-&gt;</span><span class="n">nSessionID</span> <span class="o">==</span> <span class="n">m_wSessionID</span> <span class="p">){</span>
                <span class="n">m_WBMsgProcessor</span><span class="p">.</span><span class="n">WriteLoginReq</span><span class="p">(</span><span class="n">m_dwUserID</span><span class="p">,</span><span class="n">m_dwCheckCode</span><span class="p">,</span><span class="n">m_guid</span><span class="p">);</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="n">assert</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>
                <span class="n">m_pSessionManager</span><span class="o">-&gt;</span><span class="n">CloseSession</span><span class="p">(</span> <span class="n">pEvent</span><span class="o">-&gt;</span><span class="n">nSessionID</span> <span class="p">);</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">SESSION_EVENT_CREATEFAIL</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">pEvent</span><span class="o">-&gt;</span><span class="n">nSessionID</span> <span class="o">==</span> <span class="n">m_wSessionID</span> <span class="p">){</span>
                <span class="k">this</span><span class="o">-&gt;</span><span class="n">SendNotify</span><span class="p">(</span><span class="n">WB_EVENT_CONNECTFAILED</span><span class="p">);</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="n">assert</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>
                <span class="n">m_pSessionManager</span><span class="o">-&gt;</span><span class="n">CloseSession</span><span class="p">(</span> <span class="n">pEvent</span><span class="o">-&gt;</span><span class="n">nSessionID</span> <span class="p">);</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">SESSION_EVENT_DATA</span><span class="p">:</span>
            <span class="n">m_WBMsgProcessor</span><span class="p">.</span><span class="n">ProcessMsg</span><span class="p">(</span> <span class="n">pEvent</span><span class="o">-&gt;</span><span class="n">pbData</span><span class="p">,</span><span class="n">pEvent</span><span class="o">-&gt;</span><span class="n">dwDataLen</span> <span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">SESSION_EVENT_CLOSED</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">pEvent</span><span class="o">-&gt;</span><span class="n">nSessionID</span> <span class="o">==</span> <span class="n">m_wSessionID</span> <span class="p">){</span>
                <span class="k">this</span><span class="o">-&gt;</span><span class="n">SendNotify</span><span class="p">(</span><span class="n">WB_EVENT_CONNECTIONCLOSED</span><span class="p">);</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="n">assert</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>
                <span class="n">m_pSessionManager</span><span class="o">-&gt;</span><span class="n">CloseSession</span><span class="p">(</span> <span class="n">pEvent</span><span class="o">-&gt;</span><span class="n">nSessionID</span> <span class="p">);</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">SESSION_EVENT_RECONNECTING</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">pEvent</span><span class="o">-&gt;</span><span class="n">nSessionID</span> <span class="o">==</span> <span class="n">m_wSessionID</span> <span class="p">){</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="n">assert</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>
                <span class="n">m_pSessionManager</span><span class="o">-&gt;</span><span class="n">CloseSession</span><span class="p">(</span> <span class="n">pEvent</span><span class="o">-&gt;</span><span class="n">nSessionID</span> <span class="p">);</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">SESSION_EVENT_RECONNECTED</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">pEvent</span><span class="o">-&gt;</span><span class="n">nSessionID</span> <span class="o">==</span> <span class="n">m_wSessionID</span> <span class="p">){</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="n">assert</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>
                <span class="n">m_pSessionManager</span><span class="o">-&gt;</span><span class="n">CloseSession</span><span class="p">(</span> <span class="n">pEvent</span><span class="o">-&gt;</span><span class="n">nSessionID</span> <span class="p">);</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">SESSION_EVENT_SEND</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">pEvent</span><span class="o">-&gt;</span><span class="n">nSessionID</span> <span class="o">==</span> <span class="n">m_wSessionID</span> <span class="p">){</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="n">assert</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>
                <span class="n">m_pSessionManager</span><span class="o">-&gt;</span><span class="n">CloseSession</span><span class="p">(</span> <span class="n">pEvent</span><span class="o">-&gt;</span><span class="n">nSessionID</span> <span class="p">);</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">}</span>
<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：通知</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：私有，异常通知，和关闭通知</span>
<span class="cm"> * 依赖：</span>
<span class="cm"> * 影响：</span>
<span class="cm"> * 日期：2017.07.26</span>
<span class="cm"> * 修改：无</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="n">BOOL</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">SendNotify</span><span class="p">(</span><span class="kt">int</span> <span class="n">nEvent</span><span class="p">)</span>
<span class="p">{</span>

    <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;[whiteboard] SendNotify event=&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nEvent</span><span class="p">;</span>

    <span class="n">m_nWBServerStatus</span> <span class="o">=</span> <span class="n">nEvent</span><span class="p">;</span>

    <span class="n">BOOL</span> <span class="n">bResult</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="k">switch</span><span class="p">(</span> <span class="n">m_Notify</span><span class="p">.</span><span class="n">nNotifyMode</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">case</span> <span class="nl">WBASE_NOTIFYMODE_EVENT</span><span class="p">:</span>
            <span class="c1">//		SetEvent( m_notify.EventMode.event );</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">WBASE_NOTIFYMODE_THREADMSG</span><span class="p">:</span>
            <span class="c1">//		bResult = PostThreadMessage( m_notify.ThreadMsgMode.nThreadID,m_notify.ThreadMsgMode.nNotifyMsg,nEvent,0 );</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">WBASE_NOTIFYMODE_HWNDMSG</span><span class="p">:</span>
            <span class="c1">//		bResult = PostMessage( m_notify.HwndMsgMode.hWnd,m_notify.HwndMsgMode.nNotifyMsg,nEvent,0 );</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">WBASE_NOTIFYMODE_CALLBACK</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">m_Notify</span><span class="p">.</span><span class="n">CallbackMode</span><span class="p">.</span><span class="n">pCallback</span> <span class="p">)</span>
            <span class="p">{</span>
                <span class="n">bResult</span> <span class="o">=</span> <span class="p">((</span><span class="n">WBASECALLBACK</span><span class="p">)</span><span class="n">m_Notify</span><span class="p">.</span><span class="n">CallbackMode</span><span class="p">.</span><span class="n">pCallback</span><span class="p">)(</span> <span class="n">m_Notify</span><span class="p">.</span><span class="n">CallbackMode</span><span class="p">.</span><span class="n">nMsgID</span><span class="p">,</span><span class="n">nEvent</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">m_Notify</span><span class="p">.</span><span class="n">CallbackMode</span><span class="p">.</span><span class="n">dwUserData</span> <span class="p">);</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">bResult</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：获取白板服务器登录状态</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：公有函数，私有属性获取</span>
<span class="cm"> * 依赖：打开白板时，调用</span>
<span class="cm"> * 影响：</span>
<span class="cm"> * 日期：2017.07.26</span>
<span class="cm"> * 修改：无</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="n">BOOL</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">IsWBLogin</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">m_bWbLogin</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：获取白板服务器状态</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：公有函数，私有属性获取</span>
<span class="cm"> * 依赖：</span>
<span class="cm"> * 影响：</span>
<span class="cm"> * 日期：2017.07.26</span>
<span class="cm"> * 修改：无</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="n">UINT</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">GetWBServerStatus</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">m_nWBServerStatus</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">///</span>
<span class="c1">///\brief 接口实现，供执行者MultiWBMsgProcessor回调</span>
<span class="c1">///</span>

<span class="c1">//----------------------------- IXMLDocMsgReaderCallback Function ---------------------------</span>

<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：登录白板服务器响应</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：IXMLDocMsgReaderCallback接口实现</span>
<span class="cm"> * 依赖：</span>
<span class="cm"> * 影响：判断登录成功后，会请求获取服务器上的白板；失败会发送通知</span>
<span class="cm"> * 日期：2017.07.26</span>
<span class="cm"> * 修改：无</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="n">BOOL</span>	<span class="n">ClientSocket</span><span class="o">::</span><span class="n">OnLoginRep</span><span class="p">(</span> <span class="n">WORD</span> <span class="n">wResult</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;[whiteboard] OnLoginRep result=&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">wResult</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">wResult</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">m_bWbLogin</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">SendNotify</span><span class="p">(</span><span class="n">WB_EVENT_LOGINFAILED</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">m_nWBServerStatus</span> <span class="o">=</span> <span class="n">WB_EVENT_LOGINSUCCESS</span><span class="p">;</span>
    <span class="n">m_bWbLogin</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">m_bFirstWB</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="c1">//请求获取服务器上的白板</span>
    <span class="n">m_WBMsgProcessor</span><span class="p">.</span><span class="n">WriteGetDocReq</span><span class="p">();</span>

    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：响应连接关闭</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：IXMLDocMsgReaderCallback接口实现</span>
<span class="cm"> * 依赖：</span>
<span class="cm"> * 影响：判断登录成功后，会请求获取服务器上的白板；失败会发送通知</span>
<span class="cm"> * 日期：2017.07.26</span>
<span class="cm"> * 修改：无</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="n">BOOL</span>	<span class="n">ClientSocket</span><span class="o">::</span><span class="n">OnBye</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">m_bFirstWB</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">m_bWbLogin</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">SendNotify</span><span class="p">(</span><span class="n">WB_EVENT_CONNECTIONCLOSED</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：响应从服务器发来的白板</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：IXMLDocMsgReaderCallback接口实现</span>
<span class="cm"> * 依赖：</span>
<span class="cm"> * 影响：</span>
<span class="cm"> * 日期：2017.07.26</span>
<span class="cm"> * 修改：无</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="n">BOOL</span>	<span class="n">ClientSocket</span><span class="o">::</span><span class="n">OnGetDocRep</span><span class="p">(</span> <span class="n">CHAR</span> <span class="o">*</span><span class="n">szDocData</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">dwDataLen</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;[whiteboard] ClientSocket::OnGetDocRep() &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">QString</span><span class="o">::</span><span class="n">fromLatin1</span><span class="p">(</span><span class="n">szDocData</span><span class="p">,</span><span class="n">dwDataLen</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szDocData</span> <span class="o">||</span> <span class="n">dwDataLen</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">TiXmlElement</span> <span class="nf">element</span><span class="p">(</span> <span class="s">&quot;Doc&quot;</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span> <span class="n">szDocData</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">TIXML_ENCODING_UTF8</span> <span class="p">);</span>

    <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pWBElement</span> <span class="o">=</span> <span class="n">element</span><span class="p">.</span><span class="n">FirstChildElement</span><span class="p">(</span> <span class="s">&quot;WBItem&quot;</span> <span class="p">);</span>
    <span class="k">while</span><span class="p">(</span> <span class="n">pWBElement</span> <span class="p">){</span>

        <span class="n">LoadWBElement</span><span class="p">(</span> <span class="n">pWBElement</span> <span class="p">);</span>
        <span class="n">pWBElement</span> <span class="o">=</span> <span class="n">pWBElement</span><span class="o">-&gt;</span><span class="n">NextSiblingElement</span><span class="p">(</span> <span class="s">&quot;WBItem&quot;</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pSelElement</span> <span class="o">=</span> <span class="n">element</span><span class="p">.</span><span class="n">FirstChildElement</span><span class="p">(</span> <span class="s">&quot;WBSel&quot;</span> <span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">pSelElement</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">LoadSelElement</span><span class="p">(</span> <span class="n">pSelElement</span> <span class="p">);</span>

    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：响应服务器通知，关闭所有白板</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：IXMLDocMsgReaderCallback接口实现</span>
<span class="cm"> * 依赖：</span>
<span class="cm"> * 影响：</span>
<span class="cm"> * 日期：2017.07.26</span>
<span class="cm"> * 修改：无</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="n">BOOL</span>	<span class="n">ClientSocket</span><span class="o">::</span><span class="n">OnClearDoc</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;[whiteboard] ClientSocket::OnClearDoc() &quot;</span><span class="p">;</span>
    <span class="n">m_bFirstWB</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="c1">//关闭所有白板</span>
    <span class="k">if</span><span class="p">(</span><span class="n">m_pResponse</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">m_pResponse</span><span class="o">-&gt;</span><span class="n">ResponseClearAllWB</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：响应服务器通知，相关新增操作</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：IXMLDocMsgReaderCallback接口实现</span>
<span class="cm"> * 依赖：</span>
<span class="cm"> * 影响：</span>
<span class="cm"> * 日期：2017.07.26</span>
<span class="cm"> * 修改：无</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="n">BOOL</span>	<span class="n">ClientSocket</span><span class="o">::</span><span class="n">OnInsertDocNode</span><span class="p">(</span> <span class="n">BYTE</span> <span class="n">bInsertType</span><span class="p">,</span><span class="n">BYTE</span> <span class="n">bOnlyOne</span><span class="p">,</span><span class="n">CHAR</span><span class="o">*</span> <span class="n">szParentPath</span><span class="p">,</span><span class="n">CHAR</span><span class="o">*</span> <span class="n">szInsertPosPath</span><span class="p">,</span><span class="n">CHAR</span><span class="o">*</span> <span class="n">szNodeData</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;[whiteboard] ClientSocket::OnInsertDocNode() &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">QString</span><span class="o">::</span><span class="n">fromLatin1</span><span class="p">(</span><span class="n">szNodeData</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szNodeData</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szParentPath</span> <span class="o">||</span> <span class="n">strlen</span><span class="p">(</span><span class="n">szParentPath</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
        <span class="n">TiXmlElement</span> <span class="n">element</span><span class="p">(</span> <span class="s">&quot;&quot;</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">element</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span> <span class="n">szNodeData</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">TIXML_ENCODING_UTF8</span> <span class="p">))</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">element</span><span class="p">.</span><span class="n">Value</span><span class="p">(),</span><span class="s">&quot;WBSel&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
            <span class="n">LoadSelElement</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">element</span> <span class="p">);</span>
        <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">element</span><span class="p">.</span><span class="n">Value</span><span class="p">(),</span><span class="s">&quot;WBItem&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
            <span class="n">LoadWBElement</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">element</span> <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">CHAR</span> <span class="o">*</span><span class="n">szName</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">CHAR</span> <span class="o">*</span><span class="n">szAttributeName</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">CHAR</span> <span class="o">*</span><span class="n">szAttributeValue</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">CHAR</span> <span class="o">*</span><span class="n">szPath</span> <span class="o">=</span> <span class="n">szParentPath</span><span class="p">;</span>

    <span class="n">szPath</span> <span class="o">=</span> <span class="n">ParsePath</span><span class="p">(</span> <span class="n">szPath</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeValue</span> <span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">szName</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szAttributeName</span> <span class="o">||</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szAttributeValue</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">szName</span><span class="p">,</span><span class="s">&quot;WBItem&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">szAttributeName</span><span class="p">,</span><span class="s">&quot;ID&quot;</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">DWORD</span> <span class="n">dwWBID</span> <span class="o">=</span> <span class="n">atol</span><span class="p">(</span> <span class="n">szAttributeValue</span> <span class="p">);</span>

    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szPath</span> <span class="o">||</span> <span class="n">strlen</span><span class="p">(</span><span class="n">szPath</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
        <span class="n">TiXmlElement</span> <span class="n">element</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">element</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span> <span class="n">szNodeData</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">TIXML_ENCODING_UTF8</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">element</span><span class="p">.</span><span class="n">Value</span><span class="p">(),</span><span class="s">&quot;FilList&quot;</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
            <span class="n">LoadFileListElement</span><span class="p">(</span> <span class="n">dwWBID</span><span class="p">,</span><span class="o">&amp;</span><span class="n">element</span> <span class="p">);</span>
        <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">element</span><span class="p">.</span><span class="n">Value</span><span class="p">(),</span><span class="s">&quot;Tool&quot;</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
            <span class="n">LoadToolElement</span><span class="p">(</span> <span class="n">dwWBID</span><span class="p">,</span><span class="o">&amp;</span><span class="n">element</span> <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">element</span><span class="p">.</span><span class="n">Value</span><span class="p">(),</span> <span class="s">&quot;Rotate&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="n">LoadRotateElement</span><span class="p">(</span> <span class="n">dwWBID</span><span class="p">,</span><span class="o">&amp;</span><span class="n">element</span> <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">element</span><span class="p">.</span><span class="n">Value</span><span class="p">(),</span> <span class="s">&quot;Rotate&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">LoadRotateElement</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">element</span> <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">element</span><span class="p">.</span><span class="n">Value</span><span class="p">(),</span> <span class="s">&quot;BkColor&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">LoadBkColorElement</span><span class="p">(</span> <span class="n">dwWBID</span><span class="p">,</span><span class="o">&amp;</span><span class="n">element</span> <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">element</span><span class="p">.</span><span class="n">Value</span><span class="p">(),</span><span class="s">&quot;Doc&quot;</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
            <span class="n">LoadDocElement</span><span class="p">(</span> <span class="n">dwWBID</span><span class="p">,</span><span class="o">&amp;</span><span class="n">element</span> <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">szPath</span> <span class="o">=</span> <span class="n">ParsePath</span><span class="p">(</span> <span class="n">szPath</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeValue</span> <span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">szName</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">szName</span><span class="p">,</span><span class="s">&quot;Doc&quot;</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
        <span class="n">szPath</span> <span class="o">=</span> <span class="n">ParsePath</span><span class="p">(</span> <span class="n">szPath</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeValue</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">szName</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szAttributeName</span> <span class="o">||</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szAttributeValue</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">szName</span><span class="p">,</span><span class="s">&quot;Page&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">szAttributeName</span><span class="p">,</span><span class="s">&quot;Id&quot;</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

        <span class="kt">int</span> <span class="n">nPage</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">szAttributeValue</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">nObjId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">nObjType</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">const</span> <span class="n">CHAR</span><span class="o">*</span> <span class="n">szTmpData</span> <span class="o">=</span> <span class="n">szNodeData</span><span class="p">;</span>

        <span class="k">do</span><span class="p">{</span>
            <span class="n">TiXmlElement</span> <span class="n">txml</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">);</span>
            <span class="n">szTmpData</span> <span class="o">=</span> <span class="n">txml</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">szTmpData</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">TIXML_ENCODING_UTF8</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">szTmpData</span><span class="p">)</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">txml</span><span class="p">.</span><span class="n">Value</span><span class="p">(),</span><span class="s">&quot;Obj&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">txml</span><span class="p">.</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;ID&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nObjId</span><span class="p">))</span>
                    <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">txml</span><span class="p">.</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;Type&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nObjType</span><span class="p">))</span>
                    <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

                <span class="k">this</span><span class="o">-&gt;</span><span class="n">LoadDrawObjectElement</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">,</span><span class="n">nPage</span><span class="p">,</span><span class="o">&amp;</span><span class="n">txml</span><span class="p">);</span>
            <span class="p">}</span>

        <span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="n">szTmpData</span> <span class="o">&amp;&amp;</span> <span class="n">strlen</span><span class="p">(</span><span class="n">szTmpData</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>

    <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">szName</span><span class="p">,</span><span class="s">&quot;FileList&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
<span class="c1">//        InsertWBFileNode( dwWBID, bInsertType,szPath,szInsertPosPath,szNodeData );</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>



<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：响应服务器通知，相关修改操作</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：IXMLDocMsgReaderCallback接口实现</span>
<span class="cm"> * 依赖：</span>
<span class="cm"> * 影响：</span>
<span class="cm"> * 日期：2017.07.26</span>
<span class="cm"> * 修改：无</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="n">BOOL</span>	<span class="n">ClientSocket</span><span class="o">::</span><span class="n">OnModifyDocNode</span><span class="p">(</span> <span class="n">CHAR</span> <span class="o">*</span><span class="n">szNodePath</span><span class="p">,</span><span class="n">CHAR</span> <span class="o">*</span><span class="n">szNodeData</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;[whiteboard] ClientSocket::OnModifyDocNode() &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">QString</span><span class="o">::</span><span class="n">fromLatin1</span><span class="p">(</span><span class="n">szNodeData</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szNodeData</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szNodePath</span> <span class="o">||</span> <span class="n">strlen</span><span class="p">(</span><span class="n">szNodePath</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">CHAR</span> <span class="o">*</span><span class="n">szName</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="n">CHAR</span> <span class="o">*</span><span class="n">szAttributeName</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="n">CHAR</span> <span class="o">*</span><span class="n">szAttributeValue</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="n">CHAR</span> <span class="o">*</span><span class="n">szPath</span> <span class="o">=</span> <span class="n">szNodePath</span><span class="p">;</span>

        <span class="n">szPath</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">ParsePath</span><span class="p">(</span> <span class="n">szPath</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeValue</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szName</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">szName</span><span class="p">,</span><span class="s">&quot;WBSel&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
            <span class="n">TiXmlElement</span> <span class="n">element</span><span class="p">(</span> <span class="s">&quot;&quot;</span> <span class="p">);</span>
            <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">element</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span> <span class="n">szNodeData</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">TIXML_ENCODING_UTF8</span> <span class="p">))</span>
                <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">nActiveWBID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">element</span><span class="p">.</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;Sel&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nActiveWBID</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="c1">//激活指定白板</span>
            <span class="k">if</span><span class="p">(</span><span class="n">m_pResponse</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">m_pResponse</span><span class="o">-&gt;</span><span class="n">ResponseActiveWB</span><span class="p">(</span><span class="n">nActiveWBID</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szAttributeName</span> <span class="o">||</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szAttributeValue</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">szName</span><span class="p">,</span><span class="s">&quot;WBItem&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">szAttributeName</span><span class="p">,</span><span class="s">&quot;ID&quot;</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">DWORD</span> <span class="n">dwWBID</span> <span class="o">=</span> <span class="n">atol</span><span class="p">(</span> <span class="n">szAttributeValue</span> <span class="p">);</span>

        <span class="n">szPath</span> <span class="o">=</span> <span class="n">ParsePath</span><span class="p">(</span> <span class="n">szPath</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeValue</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">szName</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">szName</span><span class="p">,</span><span class="s">&quot;Tool&quot;</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
            <span class="n">TiXmlElement</span> <span class="n">element</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">element</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span> <span class="n">szNodeData</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">TIXML_ENCODING_UTF8</span> <span class="p">)){</span>
                <span class="c1">//缩放白板</span>
                <span class="n">LoadToolElement</span><span class="p">(</span> <span class="n">dwWBID</span><span class="p">,</span><span class="o">&amp;</span><span class="n">element</span> <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">szName</span><span class="p">,</span> <span class="s">&quot;Rotate&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TiXmlElement</span> <span class="n">element</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">element</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span> <span class="n">szNodeData</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">TIXML_ENCODING_UTF8</span> <span class="p">)){</span>
                <span class="c1">//旋转</span>
                <span class="n">LoadRotateElement</span><span class="p">(</span> <span class="n">dwWBID</span><span class="p">,</span><span class="o">&amp;</span><span class="n">element</span> <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">szName</span><span class="p">,</span> <span class="s">&quot;BkColor&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TiXmlElement</span> <span class="n">element</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">element</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span> <span class="n">szNodeData</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">TIXML_ENCODING_UTF8</span> <span class="p">)){</span>
                <span class="c1">//设置背景色</span>
                <span class="n">LoadBkColorElement</span><span class="p">(</span> <span class="n">dwWBID</span><span class="p">,</span><span class="o">&amp;</span><span class="n">element</span> <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">szName</span><span class="p">,</span><span class="s">&quot;Indicator&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TiXmlElement</span> <span class="n">element</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">element</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span> <span class="n">szNodeData</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">TIXML_ENCODING_UTF8</span> <span class="p">)){</span>
                <span class="c1">//指示器位置更新</span>
                <span class="n">LoadIndicatorElement</span><span class="p">(</span> <span class="n">dwWBID</span><span class="p">,</span><span class="o">&amp;</span><span class="n">element</span> <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">szName</span><span class="p">,</span><span class="s">&quot;Doc&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
            <span class="c1">//修改图元</span>
            <span class="n">szPath</span> <span class="o">=</span> <span class="n">ParsePath</span><span class="p">(</span> <span class="n">szPath</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeValue</span> <span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">szName</span> <span class="o">||</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szAttributeName</span> <span class="o">||</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szAttributeValue</span> <span class="p">)</span>
                <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">szName</span><span class="p">,</span><span class="s">&quot;Page&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">szAttributeName</span><span class="p">,</span><span class="s">&quot;Id&quot;</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
                <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">nPage</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">szAttributeValue</span><span class="p">);</span>

            <span class="n">szPath</span> <span class="o">=</span> <span class="n">ParsePath</span><span class="p">(</span> <span class="n">szPath</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeValue</span> <span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">szName</span> <span class="o">||</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szAttributeName</span> <span class="o">||</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szAttributeValue</span> <span class="p">)</span>
                <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">szName</span><span class="p">,</span><span class="s">&quot;Obj&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">szAttributeName</span><span class="p">,</span><span class="s">&quot;ID&quot;</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
                <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">DWORD</span> <span class="n">dwObjID</span> <span class="o">=</span> <span class="n">atol</span><span class="p">(</span><span class="n">szAttributeValue</span><span class="p">);</span>

            <span class="n">TiXmlElement</span> <span class="nf">txml</span><span class="p">(</span><span class="s">&quot;Obj&quot;</span><span class="p">);</span>
            <span class="n">txml</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">szNodeData</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">TIXML_ENCODING_UTF8</span><span class="p">);</span>
            <span class="k">this</span><span class="o">-&gt;</span><span class="n">LoadDrawObjectElement</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">,</span><span class="n">nPage</span><span class="p">,</span><span class="o">&amp;</span><span class="n">txml</span><span class="p">,</span><span class="n">TRUE</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">szName</span><span class="p">,</span><span class="s">&quot;Scroll&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
            <span class="n">TiXmlElement</span> <span class="n">element</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">element</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span> <span class="n">szNodeData</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">TIXML_ENCODING_UTF8</span> <span class="p">)){</span>
                <span class="c1">//更新滚动条位置</span>
                <span class="n">LoadScrollElement</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">,</span><span class="o">&amp;</span><span class="n">element</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">szName</span><span class="p">,</span><span class="s">&quot;Action&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
            <span class="n">TiXmlElement</span> <span class="n">element</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">element</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span> <span class="n">szNodeData</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">TIXML_ENCODING_UTF8</span> <span class="p">)){</span>
                <span class="c1">//动作名称</span>
                <span class="n">LoadActionElement</span><span class="p">(</span> <span class="n">dwWBID</span><span class="p">,</span><span class="o">&amp;</span><span class="n">element</span> <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：响应服务器通知，相关删除操作</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：IXMLDocMsgReaderCallback接口实现</span>
<span class="cm"> * 依赖：</span>
<span class="cm"> * 影响：</span>
<span class="cm"> * 日期：2017.07.26</span>
<span class="cm"> * 修改：无</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="n">BOOL</span>	<span class="n">ClientSocket</span><span class="o">::</span><span class="n">OnDelDocNode</span><span class="p">(</span> <span class="n">CHAR</span> <span class="o">*</span><span class="n">szNodePath</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;[whiteboard] ClientSocket::OnDelDocNode() &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">szNodePath</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">szNodePath</span> <span class="o">||</span> <span class="n">strlen</span><span class="p">(</span><span class="n">szNodePath</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">CHAR</span> <span class="o">*</span><span class="n">szName</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">CHAR</span> <span class="o">*</span><span class="n">szAttributeName</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">CHAR</span> <span class="o">*</span><span class="n">szAttributeValue</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">CHAR</span> <span class="o">*</span><span class="n">szPath</span> <span class="o">=</span> <span class="n">szNodePath</span><span class="p">;</span>
    <span class="n">szPath</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">ParsePath</span><span class="p">(</span><span class="n">szPath</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeValue</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">szName</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">szAttributeName</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">szAttributeValue</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">szName</span><span class="p">,</span><span class="s">&quot;WBItem&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">szAttributeName</span><span class="p">,</span><span class="s">&quot;ID&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">DWORD</span> <span class="n">dwWBID</span> <span class="o">=</span> <span class="n">atol</span><span class="p">(</span><span class="n">szAttributeValue</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">szPath</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//删除白板</span>
        <span class="k">if</span><span class="p">(</span><span class="n">m_pResponse</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">m_pResponse</span><span class="o">-&gt;</span><span class="n">ResponseCloseWB</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">m_fcWbSink</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">m_fcWbSink</span><span class="p">(</span><span class="n">WB_SINK_MSG_CLOSE_WB</span><span class="p">,</span><span class="n">dwWBID</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">szPath</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">ParsePath</span><span class="p">(</span><span class="n">szPath</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeValue</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">szName</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">szName</span><span class="p">,</span><span class="s">&quot;FileList&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//删除文件</span>
        <span class="c1">//暂不实现</span>
    <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">szName</span><span class="p">,</span><span class="s">&quot;Doc&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>

        <span class="k">if</span><span class="p">(</span><span class="n">szName</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

        <span class="n">szPath</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">ParsePath</span><span class="p">(</span><span class="n">szPath</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeValue</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">szName</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">szAttributeName</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">szAttributeValue</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">szName</span><span class="p">,</span><span class="s">&quot;Page&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">szAttributeName</span><span class="p">,</span><span class="s">&quot;Id&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">nPage</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">szAttributeValue</span><span class="p">);</span>

        <span class="n">szPath</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">ParsePath</span><span class="p">(</span><span class="n">szPath</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeName</span><span class="p">,</span><span class="o">&amp;</span><span class="n">szAttributeValue</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">szName</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">szAttributeName</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">szAttributeValue</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">szName</span><span class="p">,</span><span class="s">&quot;Obj&quot;</span><span class="p">)</span> <span class="o">!=</span><span class="mi">0</span> <span class="o">||</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">szAttributeName</span><span class="p">,</span><span class="s">&quot;ID&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">DWORD</span> <span class="n">dwObjID</span> <span class="o">=</span> <span class="n">atol</span><span class="p">(</span><span class="n">szAttributeValue</span><span class="p">);</span>

        <span class="c1">//删除元素</span>
        <span class="k">if</span><span class="p">(</span><span class="n">m_pResponse</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">m_pResponse</span><span class="o">-&gt;</span><span class="n">ResponseDelDrawObj</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">,</span><span class="n">nPage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">dwObjID</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="c1">///</span>
<span class="c1">///\brief 协议解析</span>
<span class="c1">///</span>
<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：私有解析服务函数，XML处理</span>
<span class="cm"> * 依赖：</span>
<span class="cm"> * 影响：</span>
<span class="cm"> * 日期：2017.07.26</span>
<span class="cm"> * 修改：无</span>
<span class="cm"> ********************************************************************************************************/</span>

<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">LoadActionElement</span><span class="p">(</span><span class="n">DWORD</span> <span class="n">dwWBID</span><span class="p">,</span> <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pElement</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">pElement</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">CHAR</span><span class="o">*</span> <span class="n">szActionName</span> <span class="o">=</span> <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//解析白板数据</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">LoadWBElement</span><span class="p">(</span><span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pElement</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">pElement</span> <span class="p">)</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">nValue</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span> <span class="s">&quot;ID&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nValue</span> <span class="p">))</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="n">DWORD</span> <span class="n">dwWBID</span> <span class="o">=</span> <span class="n">nValue</span><span class="p">;</span>

        <span class="k">const</span> <span class="n">CHAR</span> <span class="o">*</span><span class="n">szValue</span> <span class="o">=</span> <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span> <span class="s">&quot;Name&quot;</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">szValue</span> <span class="p">)</span>
            <span class="k">return</span><span class="p">;</span>


        <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pFileListElement</span> <span class="o">=</span> <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">FirstChildElement</span><span class="p">(</span><span class="s">&quot;FileList&quot;</span><span class="p">);</span>
        <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pToolElement</span> <span class="o">=</span> <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">FirstChildElement</span><span class="p">(</span> <span class="s">&quot;Tool&quot;</span> <span class="p">);</span>
        <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pRotateElement</span> <span class="o">=</span> <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">FirstChildElement</span><span class="p">(</span> <span class="s">&quot;Rotate&quot;</span> <span class="p">);</span>
        <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pBkColorElement</span> <span class="o">=</span> <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">FirstChildElement</span><span class="p">(</span> <span class="s">&quot;BkColor&quot;</span> <span class="p">);</span>
        <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pDocElement</span> <span class="o">=</span> <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">FirstChildElement</span><span class="p">(</span><span class="s">&quot;Doc&quot;</span><span class="p">);</span>
        <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pScrollElement</span> <span class="o">=</span> <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">FirstChildElement</span><span class="p">(</span> <span class="s">&quot;Scroll&quot;</span> <span class="p">);</span>
        <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pActionElement</span> <span class="o">=</span> <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">FirstChildElement</span><span class="p">(</span> <span class="s">&quot;Action&quot;</span> <span class="p">);</span>

        <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">pFileListElement</span> <span class="o">||</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">pToolElement</span> <span class="o">||</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">pDocElement</span> <span class="p">)</span>
            <span class="k">return</span><span class="p">;</span>

        <span class="kt">int</span> <span class="n">nDocType</span> <span class="o">=</span> <span class="n">DOCTYPE_PIC</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">m_pResponse</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">m_pResponse</span><span class="o">-&gt;</span><span class="n">ResponseAddWB</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">,</span><span class="n">nDocType</span><span class="p">,</span><span class="n">szValue</span><span class="p">);</span>
        <span class="p">}</span>


        <span class="n">LoadDocElement</span><span class="p">(</span> <span class="n">dwWBID</span><span class="p">,</span><span class="n">pDocElement</span> <span class="p">);</span>
        <span class="n">LoadFileListElement</span><span class="p">(</span> <span class="n">dwWBID</span><span class="p">,</span><span class="n">pFileListElement</span> <span class="p">);</span>
        <span class="n">LoadToolElement</span><span class="p">(</span> <span class="n">dwWBID</span><span class="p">,</span><span class="n">pToolElement</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pScrollElement</span> <span class="p">)</span>
            <span class="n">LoadScrollElement</span><span class="p">(</span> <span class="n">dwWBID</span><span class="p">,</span><span class="n">pScrollElement</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pActionElement</span> <span class="p">)</span>
            <span class="n">LoadActionElement</span><span class="p">(</span> <span class="n">dwWBID</span><span class="p">,</span><span class="n">pActionElement</span> <span class="p">);</span>
        <span class="n">LoadRotateElement</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">,</span> <span class="n">pRotateElement</span> <span class="p">);</span>
        <span class="n">LoadBkColorElement</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">,</span> <span class="n">pBkColorElement</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//解析当前激活白板</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">LoadSelElement</span><span class="p">(</span><span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pElement</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span>			<span class="n">nWBID</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span> <span class="s">&quot;Sel&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nWBID</span> <span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">m_pResponse</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">m_pResponse</span><span class="o">-&gt;</span><span class="n">ResponseActiveWB</span><span class="p">(</span><span class="n">nWBID</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">LoadFileListElement</span><span class="p">(</span><span class="n">DWORD</span> <span class="n">dwWBID</span><span class="p">,</span> <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pElement</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">pElement</span> <span class="p">)</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pFileElement</span> <span class="o">=</span> <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">FirstChildElement</span><span class="p">(</span><span class="s">&quot;File&quot;</span><span class="p">);</span>
        <span class="k">while</span><span class="p">(</span> <span class="n">pFileElement</span> <span class="p">){</span>
            <span class="n">LoadWBFileElement</span><span class="p">(</span> <span class="n">dwWBID</span><span class="p">,</span><span class="n">pFileElement</span> <span class="p">);</span>
            <span class="n">pFileElement</span> <span class="o">=</span> <span class="n">pFileElement</span><span class="o">-&gt;</span><span class="n">NextSiblingElement</span><span class="p">(</span> <span class="s">&quot;File&quot;</span> <span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">LoadWBFileElement</span><span class="p">(</span><span class="n">DWORD</span> <span class="n">dwWBID</span><span class="p">,</span> <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pElement</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">pElement</span> <span class="p">)</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">nValue</span><span class="p">;</span>
        <span class="k">const</span> <span class="n">CHAR</span><span class="o">*</span> <span class="n">szValue</span> <span class="o">=</span> <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span> <span class="s">&quot;Guid&quot;</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szValue</span> <span class="p">)</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="n">WCHAR</span> <span class="n">wszGuid</span><span class="p">[</span><span class="n">MAX_PATH</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">ConvertUtf8ToUnicode</span><span class="p">(</span> <span class="n">szValue</span><span class="p">,</span><span class="n">wszGuid</span><span class="p">,</span><span class="n">MAX_PATH</span> <span class="p">))</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="n">GUID</span> <span class="n">guidFile</span><span class="p">;</span>
        <span class="n">CLSIDFromString</span><span class="p">(</span> <span class="n">wszGuid</span><span class="p">,</span><span class="o">&amp;</span><span class="n">guidFile</span> <span class="p">);</span>

        <span class="k">const</span> <span class="n">CHAR</span><span class="o">*</span> <span class="n">szSrvLink</span> <span class="o">=</span> <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span> <span class="s">&quot;Link&quot;</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">szSrvLink</span> <span class="p">)</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span> <span class="s">&quot;AppID&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nValue</span> <span class="p">))</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="n">WORD</span> <span class="n">wAppID</span> <span class="o">=</span> <span class="n">nValue</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span> <span class="s">&quot;CheckCode&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nValue</span> <span class="p">))</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="n">BOOL</span> <span class="n">bMainFile</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">BOOL</span> <span class="n">bLimitTransferSubRange</span>  <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="c1">//        CWBController *pController = m_pMultiWBController-&gt;GetWBController( dwWBID );</span>
<span class="c1">//        if( pController ){</span>
<span class="c1">//            CWBDoc *pDoc = pController-&gt;GetDoc();</span>
<span class="c1">//            if( pDoc ){</span>
<span class="c1">//                bMainFile = pDoc-&gt;GetBgFileGuid() == guidFile;</span>
<span class="c1">//                bLimitTransferSubRange  = pDoc-&gt;GetDocType() != DOCTYPE_WEB;</span>
<span class="c1">//            }</span>
<span class="c1">//        }</span>

<span class="c1">//        DWORD dwCheckCode = nValue;</span>
<span class="c1">//        m_pFileManager-&gt;RecvFile( dwWBID,guidFile,bMainFile,bLimitTransferSubRange,szSrvLink,wAppID,dwCheckCode );</span>


<span class="p">}</span>

<span class="c1">//解析白板缩放数据</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">LoadToolElement</span><span class="p">(</span><span class="n">DWORD</span> <span class="n">dwWBID</span><span class="p">,</span> <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pElement</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">pElement</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">nCurPage</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">nZoom</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;Sel&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nCurPage</span> <span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;Zoom&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nZoom</span> <span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">m_pResponse</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">m_pResponse</span><span class="o">-&gt;</span><span class="n">ResponseZoomWB</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">,</span><span class="n">nCurPage</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nZoom</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//解析白板旋转数据</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">LoadRotateElement</span><span class="p">(</span><span class="n">DWORD</span> <span class="n">dwWBID</span><span class="p">,</span> <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pElement</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">pElement</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">nAngle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;Angle&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nAngle</span> <span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">m_pResponse</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">m_pResponse</span><span class="o">-&gt;</span><span class="n">ResponseAngleWB</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">,</span><span class="n">nAngle</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//解析背景颜色数据</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">LoadBkColorElement</span><span class="p">(</span><span class="n">DWORD</span> <span class="n">dwWBID</span><span class="p">,</span> <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pElement</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">pElement</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">nColor</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;color&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nColor</span> <span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">m_pResponse</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="n">nColor</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">g</span> <span class="o">=</span> <span class="n">nColor</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">nColor</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
        <span class="n">m_pResponse</span><span class="o">-&gt;</span><span class="n">ResponseWBBackgroundColor</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//解析滚动条数据</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">LoadScrollElement</span><span class="p">(</span><span class="n">DWORD</span> <span class="n">dwWBID</span><span class="p">,</span> <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pElement</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">pElement</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">nPtX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">nPtY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">nCxRate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">nCyRate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;ptX&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nPtX</span> <span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;ptY&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nPtY</span> <span class="p">))</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;cxRate&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nCxRate</span> <span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;cyRate&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nCyRate</span><span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">m_pResponse</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">m_pResponse</span><span class="o">-&gt;</span><span class="n">ResponseScroll</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">,</span><span class="n">nPtX</span><span class="p">,</span><span class="n">nPtY</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//解析白板数据</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">LoadDocElement</span><span class="p">(</span><span class="n">DWORD</span> <span class="n">dwWBID</span><span class="p">,</span> <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pElement</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">pElement</span> <span class="p">)</span>
            <span class="k">return</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">m_pResponse</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">m_pResponse</span><span class="o">-&gt;</span><span class="n">ResponseCloseAllPage</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">int</span>     <span class="n">nWidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span>     <span class="n">nHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span>     <span class="n">nDocType</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span>		<span class="n">nValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span>		<span class="n">nPageCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span>     <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span> <span class="s">&quot;Count&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nPageCount</span> <span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">nPageCount</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span> <span class="s">&quot;Width&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nValue</span> <span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="n">nWidth</span> <span class="o">=</span> <span class="n">nValue</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span> <span class="s">&quot;Height&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nValue</span> <span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="n">nHeight</span> <span class="o">=</span> <span class="n">nValue</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span> <span class="s">&quot;Type&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nValue</span> <span class="p">))</span>
        <span class="n">nDocType</span> <span class="o">=</span> <span class="n">nValue</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="n">nDocType</span> <span class="o">=</span> <span class="n">DOCTYPE_PIC</span><span class="p">;</span>


    <span class="k">if</span><span class="p">(</span><span class="n">m_pResponse</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nPageCount</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">m_pResponse</span><span class="o">-&gt;</span><span class="n">ResponseAddPage</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">,</span><span class="n">nWidth</span><span class="p">,</span><span class="n">nHeight</span><span class="p">,</span><span class="n">nDocType</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pObjElement</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pPageElement</span> <span class="o">=</span> <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">FirstChildElement</span><span class="p">(</span><span class="s">&quot;Page&quot;</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span> <span class="n">pPageElement</span> <span class="p">){</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pPageElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;Id&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nValue</span> <span class="p">))</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">nValue</span> <span class="o">&gt;</span> <span class="n">nPageCount</span> <span class="p">)</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="n">pObjElement</span> <span class="o">=</span> <span class="n">pPageElement</span><span class="o">-&gt;</span><span class="n">FirstChildElement</span><span class="p">(</span><span class="s">&quot;Obj&quot;</span><span class="p">);</span>
        <span class="k">while</span><span class="p">(</span><span class="n">pObjElement</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="o">-&gt;</span><span class="n">LoadDrawObjectElement</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">pObjElement</span><span class="p">,</span><span class="n">FALSE</span><span class="p">);</span>
            <span class="n">pObjElement</span> <span class="o">=</span> <span class="n">pObjElement</span><span class="o">-&gt;</span><span class="n">NextSiblingElement</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="n">i</span><span class="o">++</span><span class="p">;</span>

        <span class="n">pPageElement</span> <span class="o">=</span> <span class="n">pPageElement</span><span class="o">-&gt;</span><span class="n">NextSiblingElement</span><span class="p">();</span>
    <span class="p">}</span>

<span class="c1">//    m_bSaveBgStreamInPage = TRUE;</span>
<span class="c1">//    TiXmlElement *pBgElement = pElement-&gt;FirstChildElement(&quot;BG&quot;);</span>
<span class="c1">//    if( pBgElement ){</span>
<span class="c1">//        LoadBGElement( pBgElement );</span>
<span class="c1">//    }</span>
<span class="p">}</span>

<span class="c1">//解析指示器数据</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">LoadIndicatorElement</span><span class="p">(</span><span class="n">DWORD</span> <span class="n">dwWBID</span><span class="p">,</span> <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pElement</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">pElement</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">nX</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">nY</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;X&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nX</span> <span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;Y&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nY</span> <span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">m_pResponse</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">m_pResponse</span><span class="o">-&gt;</span><span class="n">ResponseIndicatorPos</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">,</span><span class="n">nX</span><span class="p">,</span><span class="n">nY</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="c1">//解析图元对象</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">LoadDrawObjectElement</span><span class="p">(</span><span class="n">DWORD</span> <span class="n">dwWBID</span><span class="p">,</span><span class="kt">int</span> <span class="n">nPage</span><span class="p">,</span> <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pElement</span><span class="p">,</span><span class="n">BOOL</span> <span class="n">bModifyOrNew</span><span class="p">)</span>
<span class="p">{</span>
<span class="c1">//        WB_OBJTYPE_EMPTY = 0,</span>
<span class="c1">//        WB_OBJTYPE_LINE,</span>
<span class="c1">//        WB_OBJTYPE_ARROW,</span>
<span class="c1">//        WB_OBJTYPE_PENCIL,</span>
<span class="c1">//        WB_OBJTYPE_MASKPENCIL,</span>
<span class="c1">//        WB_OBJTYPE_RECT,</span>
<span class="c1">//        WB_OBJTYPE_ROUNDRECT,</span>
<span class="c1">//        WB_OBJTYPE_ELLIPSE,</span>
<span class="c1">//        WB_OBJTYPE_TEXT,</span>
<span class="c1">//        WB_OBJTYPE_HAND,</span>
<span class="c1">//        WB_OBJTYPE_PIC</span>

          <span class="kt">int</span> <span class="n">nObjId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="kt">int</span> <span class="n">nObjType</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="kt">int</span> <span class="n">nLineStyle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="kt">int</span> <span class="n">nLineWidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="kt">int</span> <span class="n">nLineColor</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="n">std</span><span class="o">::</span><span class="n">deque</span><span class="o">&lt;</span><span class="n">Point_t</span><span class="o">&gt;</span>  <span class="n">dqPoints</span><span class="p">;</span>

          <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span> <span class="p">)</span>
              <span class="k">return</span><span class="p">;</span>

          <span class="kt">int</span> <span class="n">nValue</span><span class="p">;</span>
          <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span> <span class="s">&quot;ID&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nValue</span> <span class="p">))</span>
              <span class="k">return</span><span class="p">;</span>
          <span class="n">nObjId</span> <span class="o">=</span> <span class="n">nValue</span><span class="p">;</span>

          <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span> <span class="s">&quot;Type&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nValue</span> <span class="p">))</span>
              <span class="k">return</span><span class="p">;</span>

          <span class="n">nObjType</span> <span class="o">=</span> <span class="n">nValue</span><span class="p">;</span>

          <span class="c1">//WB_OBJTYPE_PENCIL</span>
          <span class="c1">//WB_OBJTYPE_MASKPENCIL</span>
          <span class="k">if</span><span class="p">(</span><span class="n">nObjType</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">||</span> <span class="n">nObjType</span> <span class="o">==</span> <span class="mi">4</span><span class="p">){</span>
              <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span> <span class="s">&quot;LS&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nValue</span> <span class="p">))</span>
                  <span class="k">return</span><span class="p">;</span>
              <span class="n">nLineStyle</span> <span class="o">=</span> <span class="n">nValue</span><span class="p">;</span>

              <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span> <span class="s">&quot;LW&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nValue</span> <span class="p">))</span>
                  <span class="k">return</span><span class="p">;</span>
              <span class="n">nLineWidth</span> <span class="o">=</span> <span class="n">nValue</span><span class="p">;</span>

              <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span> <span class="s">&quot;LC&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nValue</span> <span class="p">))</span>
                  <span class="k">return</span><span class="p">;</span>
              <span class="n">nLineColor</span> <span class="o">=</span> <span class="n">nValue</span><span class="p">;</span>

              <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pPtElement</span> <span class="o">=</span> <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">FirstChildElement</span><span class="p">(</span> <span class="s">&quot;Pt&quot;</span> <span class="p">);</span>
              <span class="k">while</span><span class="p">(</span> <span class="n">pPtElement</span> <span class="p">){</span>
                  <span class="n">Point_t</span> <span class="n">pt</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>
                  <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pPtElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;Id&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nValue</span> <span class="p">))</span>
                      <span class="k">break</span><span class="p">;</span>
                  <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pPtElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;X&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nValue</span> <span class="p">))</span>
                      <span class="k">break</span><span class="p">;</span>
                  <span class="n">pt</span><span class="p">.</span><span class="n">nX</span> <span class="o">=</span> <span class="n">nValue</span><span class="p">;</span>
                  <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pPtElement</span><span class="o">-&gt;</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;Y&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">nValue</span> <span class="p">))</span>
                      <span class="k">break</span><span class="p">;</span>
                  <span class="n">pt</span><span class="p">.</span><span class="n">nY</span> <span class="o">=</span> <span class="n">nValue</span><span class="p">;</span>

                  <span class="n">dqPoints</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pt</span><span class="p">);</span>
                  <span class="n">pPtElement</span> <span class="o">=</span> <span class="n">pPtElement</span><span class="o">-&gt;</span><span class="n">NextSiblingElement</span><span class="p">();</span>
              <span class="p">}</span>

              <span class="k">if</span><span class="p">(</span><span class="n">m_pResponse</span><span class="p">)</span>
              <span class="p">{</span>
                  <span class="n">Color_t</span> <span class="n">lineColor</span><span class="p">;</span>
                  <span class="n">lineColor</span><span class="p">.</span><span class="n">fromBGR</span><span class="p">(</span><span class="n">nLineColor</span><span class="p">);</span>

                  <span class="k">if</span><span class="p">(</span><span class="n">nObjType</span> <span class="o">==</span> <span class="mi">4</span><span class="p">){</span>
                      <span class="n">nObjType</span> <span class="o">=</span> <span class="n">DRAWOBJ_MARKPATH</span><span class="p">;</span>
                  <span class="p">}</span><span class="k">else</span>
                  <span class="p">{</span>
                      <span class="n">nObjType</span> <span class="o">=</span> <span class="n">DRAWOBJ_PATH</span><span class="p">;</span>
                  <span class="p">}</span>

                  <span class="k">if</span><span class="p">(</span><span class="n">bModifyOrNew</span><span class="p">)</span>
                  <span class="p">{</span>
                    <span class="n">m_pResponse</span><span class="o">-&gt;</span><span class="n">ResponseModifyDrawObject</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">,</span><span class="n">nPage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">nObjId</span><span class="p">,</span><span class="n">nObjType</span><span class="p">,</span><span class="n">nLineStyle</span><span class="p">,</span><span class="n">nLineWidth</span><span class="p">,</span><span class="n">lineColor</span><span class="p">.</span><span class="n">toRGBA</span><span class="p">(),</span><span class="n">dqPoints</span><span class="p">);</span>
                  <span class="p">}</span><span class="k">else</span>
                  <span class="p">{</span>
                    <span class="n">m_pResponse</span><span class="o">-&gt;</span><span class="n">ResponseAddDrawObject</span><span class="p">(</span><span class="n">dwWBID</span><span class="p">,</span><span class="n">nPage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">nObjId</span><span class="p">,</span><span class="n">nObjType</span><span class="p">,</span><span class="n">nLineStyle</span><span class="p">,</span><span class="n">nLineWidth</span><span class="p">,</span><span class="n">lineColor</span><span class="p">.</span><span class="n">toRGBA</span><span class="p">(),</span><span class="n">dqPoints</span><span class="p">);</span>
                  <span class="p">}</span>
              <span class="p">}</span>
          <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//--------------------------------- 组装协议 -----------------------------------------------------</span>

<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">AppendToolElement</span><span class="p">(</span><span class="n">TiXmlElement</span><span class="o">*</span><span class="n">pElement</span><span class="p">,</span><span class="kt">int</span> <span class="n">nPage</span><span class="p">,</span><span class="kt">int</span> <span class="n">nZoom</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">TiXmlElement</span> <span class="n">element</span><span class="p">(</span> <span class="s">&quot;Tool&quot;</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;Sel&quot;</span><span class="p">,</span> <span class="n">nPage</span><span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;Zoom&quot;</span><span class="p">,</span><span class="n">nZoom</span> <span class="p">);</span>
    <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">InsertEndChild</span><span class="p">(</span> <span class="n">element</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">AppendRotateElement</span><span class="p">(</span><span class="n">TiXmlElement</span><span class="o">*</span><span class="n">pElement</span><span class="p">,</span><span class="kt">int</span> <span class="n">nAngle</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">TiXmlElement</span> <span class="n">element</span><span class="p">(</span> <span class="s">&quot;Rotate&quot;</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;Angle&quot;</span><span class="p">,</span> <span class="n">nAngle</span><span class="p">);</span>
    <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">InsertEndChild</span><span class="p">(</span> <span class="n">element</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">AppendBkColorElement</span><span class="p">(</span><span class="n">TiXmlElement</span><span class="o">*</span><span class="n">pElement</span><span class="p">,</span><span class="kt">int</span> <span class="n">nColor</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">TiXmlElement</span> <span class="n">element</span><span class="p">(</span> <span class="s">&quot;BkColor&quot;</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;color&quot;</span><span class="p">,</span><span class="n">nColor</span><span class="p">);</span><span class="c1">//bgr);</span>
    <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">InsertEndChild</span><span class="p">(</span> <span class="n">element</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">AppendIndicatorElement</span><span class="p">(</span><span class="n">TiXmlElement</span><span class="o">*</span><span class="n">pElement</span><span class="p">,</span><span class="kt">int</span> <span class="n">nX</span><span class="p">,</span><span class="kt">int</span> <span class="n">nY</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">TiXmlElement</span> <span class="n">element</span><span class="p">(</span> <span class="s">&quot;Indicator&quot;</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;X&quot;</span><span class="p">,</span> <span class="n">nX</span><span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;Y&quot;</span><span class="p">,</span> <span class="n">nY</span><span class="p">);</span>
    <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">InsertEndChild</span><span class="p">(</span> <span class="n">element</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">AppendDocElement</span><span class="p">(</span><span class="n">TiXmlElement</span><span class="o">*</span><span class="n">pElement</span><span class="p">,</span><span class="n">IDoc</span> <span class="o">*</span><span class="n">pDoc</span><span class="p">)</span>
<span class="p">{</span>

    <span class="k">if</span><span class="p">(</span><span class="n">pDoc</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">TiXmlElement</span> <span class="nf">element</span><span class="p">(</span><span class="s">&quot;Doc&quot;</span><span class="p">);</span>
    <span class="n">TiXmlNode</span> <span class="o">*</span><span class="n">pInsertNode</span> <span class="o">=</span> <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">InsertEndChild</span><span class="p">(</span> <span class="n">element</span> <span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">pInsertNode</span> <span class="p">){</span>
        <span class="n">TiXmlElement</span> <span class="o">*</span><span class="n">pDocElement</span> <span class="o">=</span> <span class="n">pInsertNode</span><span class="o">-&gt;</span><span class="n">ToElement</span><span class="p">();</span>
        <span class="n">pDocElement</span><span class="o">-&gt;</span><span class="n">SetAttribute</span><span class="p">(</span><span class="s">&quot;Count&quot;</span><span class="p">,</span><span class="n">pDoc</span><span class="o">-&gt;</span><span class="n">GetPageCount</span><span class="p">());</span>
        <span class="n">pDocElement</span><span class="o">-&gt;</span><span class="n">SetAttribute</span><span class="p">(</span><span class="s">&quot;Width&quot;</span><span class="p">,</span><span class="n">pDoc</span><span class="o">-&gt;</span><span class="n">GetPageWidth</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
        <span class="n">pDocElement</span><span class="o">-&gt;</span><span class="n">SetAttribute</span><span class="p">(</span><span class="s">&quot;Height&quot;</span><span class="p">,</span><span class="n">pDoc</span><span class="o">-&gt;</span><span class="n">GetPageHeight</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
        <span class="n">pDocElement</span><span class="o">-&gt;</span><span class="n">SetAttribute</span><span class="p">(</span><span class="s">&quot;Type&quot;</span><span class="p">,</span><span class="n">DOCTYPE_PIC</span><span class="p">);</span>

        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">pDoc</span><span class="o">-&gt;</span><span class="n">GetPageCount</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="o">-&gt;</span><span class="n">AppendPageElement</span><span class="p">(</span><span class="n">pDocElement</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">pDoc</span><span class="o">-&gt;</span><span class="n">GetPage</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">AppendPageElement</span><span class="p">(</span><span class="n">TiXmlElement</span><span class="o">*</span><span class="n">pElement</span><span class="p">,</span><span class="kt">int</span> <span class="n">nIdx</span><span class="p">,</span><span class="n">IPage</span> <span class="o">*</span><span class="n">pPage</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">pPage</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">TiXmlElement</span> <span class="nf">element</span><span class="p">(</span><span class="s">&quot;Page&quot;</span><span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span><span class="s">&quot;Id&quot;</span><span class="p">,</span><span class="n">nIdx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span><span class="c1">//加1是因为以前客户端会自己默认减1,并使用ID作为页码下标，如果发送出去不加1会造成对方越界崩溃</span>
    <span class="n">TiXmlNode</span> <span class="o">*</span><span class="n">pInsertNode</span> <span class="o">=</span> <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">InsertEndChild</span><span class="p">(</span><span class="n">element</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">pPage</span><span class="o">-&gt;</span><span class="n">GetDrawObjects</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">AppendDrawObjectElement</span><span class="p">(</span><span class="n">pInsertNode</span><span class="o">-&gt;</span><span class="n">ToElement</span><span class="p">(),</span><span class="n">pPage</span><span class="o">-&gt;</span><span class="n">GetDrawObjectIndex</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">AppendDrawObjectElement</span><span class="p">(</span><span class="n">TiXmlElement</span><span class="o">*</span><span class="n">pElement</span><span class="p">,</span><span class="n">IDrawObject</span> <span class="o">*</span><span class="n">pDrawObj</span><span class="p">)</span>
<span class="p">{</span>

    <span class="k">if</span><span class="p">(</span><span class="n">pDrawObj</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">nType</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">pDrawObj</span><span class="o">-&gt;</span><span class="n">GetObjectType</span><span class="p">()</span> <span class="o">==</span> <span class="n">DRAWOBJ_MARKPATH</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">nType</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">TiXmlElement</span> <span class="n">element</span><span class="p">(</span><span class="s">&quot;Obj&quot;</span><span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;ID&quot;</span><span class="p">,</span><span class="n">pDrawObj</span><span class="o">-&gt;</span><span class="n">GetObjectId</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;Type&quot;</span><span class="p">,</span> <span class="n">nType</span><span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;LS&quot;</span><span class="p">,(</span><span class="kt">int</span><span class="p">)</span><span class="n">pDrawObj</span><span class="o">-&gt;</span><span class="n">GetLineStyle</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;LW&quot;</span><span class="p">,</span><span class="n">pDrawObj</span><span class="o">-&gt;</span><span class="n">GetLineWidth</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">Color_t</span> <span class="n">cr</span><span class="p">;</span>
    <span class="n">cr</span><span class="p">.</span><span class="n">fromRGBA</span><span class="p">(</span><span class="n">pDrawObj</span><span class="o">-&gt;</span><span class="n">GetColorRgba</span><span class="p">());</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;LC&quot;</span><span class="p">,</span><span class="n">cr</span><span class="p">.</span><span class="n">toBGR</span><span class="p">());</span>


    <span class="n">std</span><span class="o">::</span><span class="n">deque</span><span class="o">&lt;</span><span class="n">Point_t</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pDqData</span> <span class="o">=</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">deque</span><span class="o">&lt;</span><span class="n">Point_t</span><span class="o">&gt;*</span><span class="p">)</span><span class="n">pDrawObj</span><span class="o">-&gt;</span><span class="n">GetData</span><span class="p">();</span>

    <span class="kt">int</span> <span class="n">nCount</span> <span class="o">=</span> <span class="n">pDqData</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nCount</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">TiXmlElement</span> <span class="n">ptElement</span><span class="p">(</span><span class="s">&quot;Pt&quot;</span><span class="p">);</span>
        <span class="n">ptElement</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;Id&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">);</span>
        <span class="n">ptElement</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;X&quot;</span><span class="p">,</span><span class="n">pDqData</span><span class="o">-&gt;</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">nX</span> <span class="p">);</span>
        <span class="n">ptElement</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;Y&quot;</span><span class="p">,</span><span class="n">pDqData</span><span class="o">-&gt;</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">nY</span> <span class="p">);</span>
        <span class="n">element</span><span class="p">.</span><span class="n">InsertEndChild</span><span class="p">(</span> <span class="n">ptElement</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">InsertEndChild</span><span class="p">(</span><span class="n">element</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">AppendScrollElement</span><span class="p">(</span><span class="n">TiXmlElement</span><span class="o">*</span><span class="n">pElement</span><span class="p">,</span><span class="kt">int</span> <span class="n">nX</span><span class="p">,</span><span class="kt">int</span> <span class="n">nY</span><span class="p">,</span><span class="kt">int</span> <span class="n">nCxRate</span><span class="p">,</span><span class="kt">int</span> <span class="n">nCyRate</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">TiXmlElement</span> <span class="n">element</span><span class="p">(</span> <span class="s">&quot;Scroll&quot;</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;ptX&quot;</span><span class="p">,</span><span class="n">nX</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;ptY&quot;</span><span class="p">,</span><span class="n">nY</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span><span class="s">&quot;cxRate&quot;</span><span class="p">,</span><span class="n">nCxRate</span><span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span><span class="s">&quot;cyRate&quot;</span><span class="p">,</span><span class="n">nCyRate</span><span class="p">);</span>
    <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">InsertEndChild</span><span class="p">(</span> <span class="n">element</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">AppendActionElement</span><span class="p">(</span><span class="n">TiXmlElement</span><span class="o">*</span><span class="n">pElement</span><span class="p">,</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="n">szName</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">TiXmlElement</span> <span class="n">element</span><span class="p">(</span> <span class="s">&quot;Action&quot;</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="n">szName</span> <span class="p">);</span>
    <span class="n">pElement</span><span class="o">-&gt;</span><span class="n">InsertEndChild</span><span class="p">(</span> <span class="n">element</span> <span class="p">);</span>
<span class="p">}</span>








<span class="c1">///</span>
<span class="c1">///\brief --------------------------------- INetWorkRequest接口 -----------------------------------------</span>
<span class="c1">///</span>
<span class="c1">///</span>




<span class="cm">/********************************************************************************************************</span>
<span class="cm"> * 描述：添加白板</span>
<span class="cm"> * 参数：</span>
<span class="cm"> * 环境：网络指令发送接口INetWorkRequest实现</span>
<span class="cm"> * 依赖：</span>
<span class="cm"> * 影响：</span>
<span class="cm"> * 日期：2017.07.26</span>
<span class="cm"> * 修改：无</span>
<span class="cm"> ********************************************************************************************************/</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">RequestAddWB</span><span class="p">(</span><span class="n">IContainerView</span> <span class="o">*</span><span class="n">pWB</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">pWB</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">CHAR</span> <span class="n">szValue</span><span class="p">[</span><span class="n">MAX_PATH</span><span class="p">];</span>
    <span class="n">TiXmlElement</span> <span class="nf">WBElement</span><span class="p">(</span> <span class="s">&quot;WBItem&quot;</span> <span class="p">);</span>
    <span class="n">WBElement</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;ID&quot;</span><span class="p">,</span><span class="n">pWB</span><span class="o">-&gt;</span><span class="n">GetDoc</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetWBId</span><span class="p">()</span> <span class="p">);</span>
    <span class="k">const</span> <span class="n">WCHAR</span> <span class="o">*</span><span class="n">wszName</span> <span class="o">=</span> <span class="n">pWB</span><span class="o">-&gt;</span><span class="n">GetDoc</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetTitleName</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">wszName</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">_tcslen</span><span class="p">(</span> <span class="n">wszName</span> <span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="c1">//生成白板名称节点</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">ConvertUnicodeToUtf8</span><span class="p">(</span> <span class="n">wszName</span><span class="p">,</span><span class="n">szValue</span><span class="p">,</span><span class="n">MAX_PATH</span> <span class="p">)){</span>
        <span class="n">WBElement</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="n">szValue</span> <span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="n">WBElement</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">//生成子文件列表节点</span>
    <span class="c1">//注意: 当前并没有填入具体子文件信息,需要等待文件服务器返馈</span>
    <span class="p">{</span>
        <span class="n">TiXmlElement</span> <span class="n">element</span><span class="p">(</span><span class="s">&quot;FileList&quot;</span><span class="p">);</span>
        <span class="n">WBElement</span><span class="p">.</span><span class="n">InsertEndChild</span><span class="p">(</span> <span class="n">element</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">//生成工具属性节点</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">AppendToolElement</span><span class="p">(</span><span class="o">&amp;</span><span class="n">WBElement</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">pWB</span><span class="o">-&gt;</span><span class="n">GetZoom</span><span class="p">());</span>

    <span class="c1">//旋转</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">AppendRotateElement</span><span class="p">(</span><span class="o">&amp;</span><span class="n">WBElement</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="c1">//暂不支持旋转</span>

    <span class="c1">//bkcolor</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">AppendBkColorElement</span><span class="p">(</span><span class="o">&amp;</span><span class="n">WBElement</span><span class="p">,</span><span class="mh">0xffffff</span><span class="p">);</span><span class="c1">//bgr</span>

    <span class="c1">//Indicator</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">AppendIndicatorElement</span><span class="p">(</span><span class="o">&amp;</span><span class="n">WBElement</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>

    <span class="c1">//生成白板页面内容节点,并读入页面数据</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">AppendDocElement</span><span class="p">(</span><span class="o">&amp;</span><span class="n">WBElement</span><span class="p">,</span><span class="n">pWB</span><span class="o">-&gt;</span><span class="n">GetDoc</span><span class="p">());</span>

    <span class="c1">//生成滚动位置节点</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">AppendScrollElement</span><span class="p">(</span><span class="o">&amp;</span><span class="n">WBElement</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>

    <span class="c1">//页面动作</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">AppendActionElement</span><span class="p">(</span><span class="o">&amp;</span><span class="n">WBElement</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">);</span>

    <span class="p">{</span>
        <span class="n">TIXML_OSTREAM</span> <span class="n">stream</span><span class="p">;</span>
        <span class="n">stream</span><span class="o">&lt;&lt;</span><span class="n">WBElement</span><span class="p">;</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">m_WBMsgProcessor</span><span class="p">.</span><span class="n">WriteInsertDocNode</span><span class="p">(</span> <span class="n">XMLDOC_INSERT_END</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,(</span><span class="n">CHAR</span><span class="o">*</span><span class="p">)</span><span class="n">stream</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">m_bFirstWB</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">m_bFirstWB</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">TiXmlElement</span> <span class="nf">ele</span><span class="p">(</span><span class="s">&quot;WBSel&quot;</span><span class="p">);</span>
        <span class="n">ele</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span><span class="s">&quot;Sel&quot;</span><span class="p">,</span><span class="n">pWB</span><span class="o">-&gt;</span><span class="n">GetDoc</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetWBId</span><span class="p">());</span>
        <span class="n">TIXML_OSTREAM</span> <span class="n">stream</span><span class="p">;</span>
        <span class="n">stream</span><span class="o">&lt;&lt;</span><span class="n">ele</span><span class="p">;</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">m_WBMsgProcessor</span><span class="p">.</span><span class="n">WriteInsertDocNode</span><span class="p">(</span> <span class="n">XMLDOC_INSERT_END</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,(</span><span class="n">CHAR</span><span class="o">*</span><span class="p">)</span><span class="n">stream</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//添加图元</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">RequestAddDrawObject</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">nWBId</span><span class="p">,</span><span class="kt">int</span> <span class="n">nPage</span><span class="p">,</span><span class="n">IDrawObject</span> <span class="o">*</span><span class="n">pDrawObj</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">CHAR</span> <span class="n">szParentPath</span><span class="p">[</span><span class="n">MAX_PATH</span><span class="p">];</span>
    <span class="n">sprintf</span><span class="p">(</span> <span class="n">szParentPath</span><span class="p">,</span><span class="s">&quot;WBItem ID=%d/Doc/Page Id=%d&quot;</span><span class="p">,(</span><span class="kt">int</span><span class="p">)</span><span class="n">nWBId</span><span class="p">,</span><span class="n">nPage</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str</span><span class="p">;</span>

    <span class="n">TiXmlElement</span> <span class="nf">element</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">AppendDrawObjectElement</span><span class="p">(</span><span class="o">&amp;</span><span class="n">element</span><span class="p">,</span><span class="n">pDrawObj</span><span class="p">);</span>

    <span class="n">TIXML_OSTREAM</span> <span class="n">stream</span><span class="p">;</span>
    <span class="n">stream</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">element</span><span class="p">.</span><span class="n">FirstChildElement</span><span class="p">();</span>
    <span class="n">str</span> <span class="o">=</span> <span class="n">stream</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">m_WBMsgProcessor</span><span class="p">.</span><span class="n">WriteInsertDocNode</span><span class="p">(</span> <span class="n">XMLDOC_INSERT_END</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">szParentPath</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,(</span><span class="n">CHAR</span><span class="o">*</span><span class="p">)</span><span class="n">str</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">//激活白板</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">RequestActiveWB</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">nWBId</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">TiXmlElement</span> <span class="n">element</span><span class="p">(</span><span class="s">&quot;WBSel&quot;</span><span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;Sel&quot;</span><span class="p">,</span><span class="n">nWBId</span><span class="p">);</span>
    <span class="n">TIXML_OSTREAM</span> <span class="n">stream</span><span class="p">;</span>
    <span class="n">stream</span><span class="o">&lt;&lt;</span><span class="n">element</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">m_WBMsgProcessor</span><span class="p">.</span><span class="n">WriteModifyDocNode</span><span class="p">(</span> <span class="p">(</span><span class="n">CHAR</span> <span class="o">*</span><span class="p">)</span><span class="s">&quot;WBSel&quot;</span><span class="p">,(</span><span class="n">CHAR</span><span class="o">*</span><span class="p">)</span><span class="n">stream</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">//修改图元</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">RequestModifyDrawObject</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">nWBId</span><span class="p">,</span><span class="kt">int</span> <span class="n">nPage</span><span class="p">,</span><span class="n">IDrawObject</span> <span class="o">*</span><span class="n">pDrawObj</span><span class="p">)</span>
<span class="p">{</span>

    <span class="k">if</span><span class="p">(</span><span class="n">pDrawObj</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">nObjID</span> <span class="o">=</span> <span class="n">pDrawObj</span><span class="o">-&gt;</span><span class="n">GetObjectId</span><span class="p">();</span>
    <span class="n">CHAR</span>  <span class="n">szNodePath</span><span class="p">[</span><span class="mi">126</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="n">sprintf</span><span class="p">(</span> <span class="n">szNodePath</span><span class="p">,</span><span class="s">&quot;WBItem ID=%d/Doc/Page Id=%d/Obj ID=%d&quot;</span><span class="p">,(</span><span class="kt">int</span><span class="p">)</span><span class="n">nWBId</span><span class="p">,</span><span class="n">nPage</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nObjID</span> <span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str</span><span class="p">;</span>


    <span class="n">TiXmlElement</span> <span class="nf">element</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">AppendDrawObjectElement</span><span class="p">(</span><span class="o">&amp;</span><span class="n">element</span><span class="p">,</span><span class="n">pDrawObj</span><span class="p">);</span>

    <span class="n">TIXML_OSTREAM</span> <span class="n">stream</span><span class="p">;</span>
    <span class="n">stream</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">element</span><span class="p">.</span><span class="n">FirstChildElement</span><span class="p">();</span>
    <span class="n">str</span> <span class="o">=</span> <span class="n">stream</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">m_WBMsgProcessor</span><span class="p">.</span><span class="n">WriteModifyDocNode</span><span class="p">(</span> <span class="n">szNodePath</span><span class="p">,(</span><span class="n">CHAR</span><span class="o">*</span><span class="p">)</span><span class="n">str</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">//缩放白板</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">RequestModifyZoom</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">nWBId</span><span class="p">,</span><span class="kt">int</span> <span class="n">nPage</span><span class="p">,</span><span class="kt">int</span> <span class="n">nZoom</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">CHAR</span>  <span class="n">szNodePath</span><span class="p">[</span><span class="mi">126</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="n">sprintf</span><span class="p">(</span> <span class="n">szNodePath</span><span class="p">,</span><span class="s">&quot;WBItem ID=%d/Tool&quot;</span><span class="p">,(</span><span class="kt">int</span><span class="p">)</span><span class="n">nWBId</span> <span class="p">);</span>

    <span class="n">TiXmlElement</span> <span class="nf">element</span><span class="p">(</span> <span class="s">&quot;Tool&quot;</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;Sel&quot;</span><span class="p">,</span><span class="n">nPage</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;Zoom&quot;</span><span class="p">,</span><span class="n">nZoom</span> <span class="p">);</span>
    <span class="n">TIXML_OSTREAM</span> <span class="n">stream</span><span class="p">;</span>
    <span class="n">stream</span><span class="o">&lt;&lt;</span><span class="n">element</span><span class="p">;</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">m_WBMsgProcessor</span><span class="p">.</span><span class="n">WriteModifyDocNode</span><span class="p">(</span> <span class="n">szNodePath</span><span class="p">,(</span><span class="n">CHAR</span><span class="o">*</span><span class="p">)</span><span class="n">stream</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">//指示器位置</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">RequestModifyIndicator</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">nWBId</span><span class="p">,</span><span class="kt">int</span> <span class="n">nX</span><span class="p">,</span><span class="kt">int</span> <span class="n">nY</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">CHAR</span>  <span class="n">szNodePath</span><span class="p">[</span><span class="mi">126</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="n">sprintf</span><span class="p">(</span> <span class="n">szNodePath</span><span class="p">,</span><span class="s">&quot;WBItem ID=%d/Indicator&quot;</span><span class="p">,(</span><span class="kt">int</span><span class="p">)</span><span class="n">nWBId</span> <span class="p">);</span>

    <span class="n">TiXmlElement</span> <span class="nf">element</span><span class="p">(</span> <span class="s">&quot;Indicator&quot;</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;X&quot;</span><span class="p">,</span><span class="n">nX</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;Y&quot;</span><span class="p">,</span><span class="n">nY</span> <span class="p">);</span>
    <span class="n">TIXML_OSTREAM</span> <span class="n">stream</span><span class="p">;</span>
    <span class="n">stream</span><span class="o">&lt;&lt;</span><span class="n">element</span><span class="p">;</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">m_WBMsgProcessor</span><span class="p">.</span><span class="n">WriteModifyDocNode</span><span class="p">(</span> <span class="n">szNodePath</span><span class="p">,(</span><span class="n">CHAR</span><span class="o">*</span><span class="p">)</span><span class="n">stream</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">//滚动条位置</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">RequestModifyScroll</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">nWBId</span><span class="p">,</span><span class="kt">int</span> <span class="n">nX</span><span class="p">,</span><span class="kt">int</span> <span class="n">nY</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">CHAR</span>  <span class="n">szNodePath</span><span class="p">[</span><span class="mi">126</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="n">sprintf</span><span class="p">(</span> <span class="n">szNodePath</span><span class="p">,</span><span class="s">&quot;WBItem ID=%d/Scroll&quot;</span><span class="p">,(</span><span class="kt">int</span><span class="p">)</span><span class="n">nWBId</span> <span class="p">);</span>

    <span class="n">TiXmlElement</span> <span class="nf">element</span><span class="p">(</span> <span class="s">&quot;Scroll&quot;</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;ptX&quot;</span><span class="p">,</span><span class="n">nX</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;ptY&quot;</span><span class="p">,</span><span class="n">nY</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;cxRate&quot;</span><span class="p">,</span><span class="mi">100</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;cyRate&quot;</span><span class="p">,</span><span class="mi">100</span> <span class="p">);</span>
    <span class="n">TIXML_OSTREAM</span> <span class="n">stream</span><span class="p">;</span>
    <span class="n">stream</span><span class="o">&lt;&lt;</span><span class="n">element</span><span class="p">;</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">m_WBMsgProcessor</span><span class="p">.</span><span class="n">WriteModifyDocNode</span><span class="p">(</span> <span class="n">szNodePath</span><span class="p">,(</span><span class="n">CHAR</span><span class="o">*</span><span class="p">)</span><span class="n">stream</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">//旋转白板</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">RequestRotate</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">nWBId</span><span class="p">,</span><span class="kt">int</span> <span class="n">nAngle</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">CHAR</span>  <span class="n">szNodePath</span><span class="p">[</span><span class="mi">126</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="n">sprintf</span><span class="p">(</span> <span class="n">szNodePath</span><span class="p">,</span><span class="s">&quot;WBItem ID=%d/Rotate&quot;</span><span class="p">,(</span><span class="kt">int</span><span class="p">)</span><span class="n">nWBId</span> <span class="p">);</span>

    <span class="n">TiXmlElement</span> <span class="nf">element</span><span class="p">(</span> <span class="s">&quot;Rotate&quot;</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;Angle&quot;</span><span class="p">,</span><span class="n">nAngle</span><span class="p">);</span>
    <span class="n">TIXML_OSTREAM</span> <span class="n">stream</span><span class="p">;</span>
    <span class="n">stream</span><span class="o">&lt;&lt;</span><span class="n">element</span><span class="p">;</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">m_WBMsgProcessor</span><span class="p">.</span><span class="n">WriteModifyDocNode</span><span class="p">(</span> <span class="n">szNodePath</span><span class="p">,(</span><span class="n">CHAR</span><span class="o">*</span><span class="p">)</span><span class="n">stream</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">//设置背景色</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">RequestBkColor</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">nWBId</span><span class="p">,</span><span class="kt">int32_t</span> <span class="n">nRgbaColor</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">CHAR</span>  <span class="n">szNodePath</span><span class="p">[</span><span class="mi">126</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="n">sprintf</span><span class="p">(</span> <span class="n">szNodePath</span><span class="p">,</span><span class="s">&quot;WBItem ID=%d/BkColor&quot;</span><span class="p">,(</span><span class="kt">int</span><span class="p">)</span><span class="n">nWBId</span> <span class="p">);</span>

    <span class="n">Color_t</span> <span class="n">color</span><span class="p">;</span>
    <span class="n">color</span><span class="p">.</span><span class="n">fromRGBA</span><span class="p">(</span><span class="n">nRgbaColor</span><span class="p">);</span>

    <span class="n">TiXmlElement</span> <span class="nf">element</span><span class="p">(</span> <span class="s">&quot;BkColor&quot;</span> <span class="p">);</span>
    <span class="n">element</span><span class="p">.</span><span class="n">SetAttribute</span><span class="p">(</span> <span class="s">&quot;color&quot;</span><span class="p">,</span><span class="n">color</span><span class="p">.</span><span class="n">toBGR</span><span class="p">());</span><span class="c1">//以前协议传递的颜色值为bgr</span>
    <span class="n">TIXML_OSTREAM</span> <span class="n">stream</span><span class="p">;</span>
    <span class="n">stream</span><span class="o">&lt;&lt;</span><span class="n">element</span><span class="p">;</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">m_WBMsgProcessor</span><span class="p">.</span><span class="n">WriteModifyDocNode</span><span class="p">(</span> <span class="n">szNodePath</span><span class="p">,(</span><span class="n">CHAR</span><span class="o">*</span><span class="p">)</span><span class="n">stream</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">//关闭白板</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">RequestCloseWB</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">nWBId</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">CHAR</span> <span class="n">szNodePath</span><span class="p">[</span><span class="mi">128</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="n">sprintf</span><span class="p">(</span><span class="n">szNodePath</span><span class="p">,</span><span class="s">&quot;WBItem ID=%d&quot;</span><span class="p">,</span><span class="n">nWBId</span><span class="p">);</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">m_WBMsgProcessor</span><span class="p">.</span><span class="n">WriteDelDocNode</span><span class="p">(</span><span class="n">szNodePath</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//关闭所有白板</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">RequestCloseAllWB</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">m_WBMsgProcessor</span><span class="p">.</span><span class="n">WriteClearDoc</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">//删除图元</span>
<span class="kt">void</span> <span class="n">ClientSocket</span><span class="o">::</span><span class="n">RequestDelDrawObject</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">nWBId</span><span class="p">,</span><span class="kt">int</span> <span class="n">nPage</span><span class="p">,</span><span class="kt">int</span> <span class="n">nObjId</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">CHAR</span>  <span class="n">szNodePath</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="n">sprintf</span><span class="p">(</span> <span class="n">szNodePath</span><span class="p">,</span><span class="s">&quot;WBItem ID=%d/Doc/Page Id=%d/Obj ID=%d&quot;</span><span class="p">,(</span><span class="kt">int</span><span class="p">)</span><span class="n">nWBId</span><span class="p">,</span><span class="n">nPage</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nObjId</span> <span class="p">);</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">m_WBMsgProcessor</span><span class="p">.</span><span class="n">WriteDelDocNode</span><span class="p">(</span> <span class="n">szNodePath</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</body>
</html>
